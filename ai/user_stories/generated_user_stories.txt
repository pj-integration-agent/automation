**User Story 1 – Cadastro de Novo Banco (US01)**  
> **Como** usuário autorizado ao sistema de bancos nacionais,  
> **eu quero** cadastrar um novo banco preenchendo “Código”, “Descrição do Banco”, “Apelido”, “Número de inscrição no SBP”, “Banco Controlador” (lista) e “CNPJ”,  
> **para** que o banco fique disponível na base de dados e possa ser consultado e editado pelos usuários autorizados.  

**Descrição detalhada**  
- O botão “Novo” abre a tela de cadastro.  
- Todos os campos listados são obrigatórios.  
- “Código” deve ser único; o sistema impede salvar se existir outro registro com o mesmo valor.  
- “Banco Controlador” é selecionado de uma lista carregada do banco de dados.  
- “CNPJ” deve ser válido (formato 14 dígitos) e existir em cadastro oficial (consulta a API de CNPJ).  
- Ao clicar em “Salvar”, o sistema valida todos os requisitos e persiste o registro.  
- Caso a validação falhe, mensagens de erro específicas são exibidas ao usuário.

**Critérios de Aceitação**  
1. O botão “Novo” abre a tela de cadastro vazia.  
2. Todos os campos são exibidos e marcados como obrigatórios.  
3. Ao tentar salvar com um “Código” já existente, o sistema mostra a mensagem *“Código já cadastrado. Por favor, informe outro.”*  
4. Ao enviar um “CNPJ” inválido ou inexistente, o sistema mostra a mensagem *“CNPJ inválido ou inexistente.”*  
5. Ao preencher todos os campos corretamente, ao clicar em “Salvar” o registro é salvo e o usuário volta para a lista de bancos com o novo registro visível.  
6. O campo “Código” permanece inalterável após o registro.  

**BDD – Cenários Positivos**  
```gherkin
Feature: Cadastro de Novo Banco

Scenario: Cadastro bem-sucedido de um novo banco
  Given eu estou autenticado como usuário autorizado
  When eu clico em "Novo"
  And eu preencho o campo "Código" com "BN001"
  And eu preencho o campo "Descrição do Banco" com "Banco Nacional de Testes"
  And eu preencho o campo "Apelido" com "BNT"
  And eu preencho o campo "Número de inscrição no SBP" com "12345678"
  And eu seleciono "Banco XYZ" na lista "Banco Controlador"
  And eu preencho o campo "CNPJ" com "12.345.678/0001-90"
  And eu clico em "Salvar"
  Then o sistema deve persistir o novo registro
  And a lista de bancos deve exibir um banco com "Código" BN001
```

**BDD – Cenários Negativos**  
```gherkin
Scenario: Tentar cadastrar com Código duplicado
  Given eu estou autenticado como usuário autorizado
  And já existe um banco com Código "BN001"
  When eu clico em "Novo"
  And eu preencho o campo "Código" com "BN001"
  And preencho os demais campos corretamente
  And eu clico em "Salvar"
  Then o sistema deve exibir a mensagem "Código já cadastrado. Por favor, informe outro."
  And o banco não é salvo

Scenario: Tentar cadastrar com CNPJ inválido
  Given eu estou autenticado como usuário autorizado
  When eu clico em "Novo"
  And eu preencho o campo "Código" com "BN002"
  And eu preencho o campo "Descrição do Banco" com "Banco Inválido"
  And eu preencho o campo "Apelido" com "BIN"
  And eu preencho o campo "Número de inscrição no SBP" com "87654321"
  And eu seleciono "Banco XYZ" na lista "Banco Controlador"
  And eu preencho o campo "CNPJ" com "12.345.678/0001-99"  # CNPJ não existente
  And eu clico em "Salvar"
  Then o sistema deve exibir a mensagem "CNPJ inválido ou inexistente."
  And o banco não é salvo
```

---

**User Story 2 – Edição de Banco já Cadastrado (US02)**  
> **Como** usuário autorizado,  
> **eu quero** abrir um registro existente e alterar “Descrição do Banco”, “Apelido”, “Número de inscrição no SBP”, “Banco Controlador” e “CNPJ”,  
> **para** manter o cadastro atualizado sem precisar criar um novo registro.

**Descrição detalhada**  
- A lista de bancos permite selecionar um registro e abrir a tela de edição.  
- O campo “Código” é exibido, porém bloqueado (não pode ser alterado).  
- Todos os demais campos permanecem obrigatórios.  
- Alterações em “CNPJ” passam pela mesma validação de formato e existência.  
- Ao clicar em “Salvar”, o sistema atualiza o registro e retorna à lista.  
- Se alguma validação falhar, a mensagem de erro específica é mostrada.

**Critérios de Aceitação**  
1. Ao abrir um banco já cadastrado, todos os campos (exceto Código) são preenchidos com os valores existentes.  
2. O campo “Código” é exibido como somente leitura.  
3. Alterar “CNPJ” para um valor inválido impede a gravação e mostra a mensagem de erro apropriada.  
4. Ao salvar alterações válidas, o registro é atualizado na base de dados.  
5. A lista de bancos reflete imediatamente as alterações feitas.  

**BDD – Cenários Positivos**  
```gherkin
Feature: Edição de Banco já Cadastrado

Scenario: Editar informações de um banco existente
  Given eu estou autenticado como usuário autorizado
  And já existe um banco com Código "BN001"
  When eu seleciono o banco BN001 na lista
  And eu clico em "Editar"
  And eu altero "Descrição do Banco" para "Banco Nacional de Teste Atualizado"
  And eu altero "Apelido" para "BNTU"
  And eu altero "Número de inscrição no SBP" para "11223344"
  And eu seleciono "Banco ABC" na lista "Banco Controlador"
  And eu altero "CNPJ" para "98.765.432/0001-10"
  And eu clico em "Salvar"
  Then o banco BN001 deve ter suas informações atualizadas
  And a lista de bancos deve exibir as novas informações
```

**BDD – Cenários Negativos**  
```gherkin
Scenario: Tentar alterar o Código de um banco
  Given eu estou autenticado como usuário autorizado
  And já existe um banco com Código "BN001"
  When eu seleciono o banco BN001 na lista
  And eu clico em "Editar"
  And eu tento alterar o campo "Código" para "BN002"
  And eu clico em "Salvar"
  Then o sistema deve ignorar a tentativa de alteração de Código
  And o Código permanece BN001

Scenario: Tentar salvar edição com CNPJ inválido
  Given eu estou autenticado como usuário autorizado
  And já existe um banco com Código "BN001"
  When eu seleciono o banco BN001 na lista
  And eu clico em "Editar"
  And eu altero "CNPJ" para "12.345.678/0001-99"  # CNPJ não existente
  And eu clico em "Salvar"
  Then o sistema deve exibir a mensagem "CNPJ inválido ou inexistente."
  And o registro não é atualizado
```

---

**User Story 3 – Validação de CNPJ (US03)**  
> **Como** usuário autorizado,  
> **eu quero** que o sistema valide o CNPJ informado durante cadastro ou edição,  
> **para** garantir que apenas bancos com CNPJ real e existente sejam cadastrados ou atualizados.

**Descrição detalhada**  
- O campo CNPJ aceita apenas 14 dígitos (pode ser formatado com pontuação).  
- A aplicação faz uma consulta a um serviço oficial (ex.: ReceitaWS, API do CNPJ) para confirmar a existência e a validade do número.  
- Se a consulta falhar ou o CNPJ for inválido, uma mensagem de erro é mostrada e o usuário não pode prosseguir.  

**Critérios de Aceitação**  
1. O campo aceita apenas números (e formatação opcional).  
2. Ao tentar salvar um CNPJ com menos ou mais de 14 dígitos, o sistema mostra a mensagem *“CNPJ deve conter 14 dígitos.”*  
3. Se o CNPJ não existir no banco de dados oficial, o sistema mostra *“CNPJ inválido ou inexistente.”*  
4. Quando o CNPJ for válido e existir, o sistema permite a gravação.  

**BDD – Cenários Positivos**  
```gherkin
Feature: Validação de CNPJ

Scenario: Salvar banco com CNPJ válido
  Given eu estou autenticado como usuário autorizado
  When eu preencho o campo "CNPJ" com "12.345.678/0001-90"  # número existente
  And eu salvo o cadastro
  Then o sistema deve aceitar o cadastro
```

**BDD – Cenários Negativos**  
```gherkin
Scenario: CNPJ com dígitos insuficientes
  Given eu estou autenticado como usuário autorizado
  When eu preencho o campo "CNPJ" com "12.345.678/0001-9"
  And eu salvo o cadastro
  Then o sistema deve exibir "CNPJ deve conter 14 dígitos."
  And o cadastro não é salvo

Scenario: CNPJ inexistente no cadastro oficial
  Given eu estou autenticado como usuário autorizado
  When eu preencho o campo "CNPJ" com "12.345.678/0001-99"  # número não registrado
  And eu salvo o cadastro
  Then o sistema deve exibir "CNPJ inválido ou inexistente."
  And o cadastro não é salvo
```

---

### Rastreabilidade

| ID | User Story | BDD Scenarios |
|----|------------|---------------|
| **US01** | Cadastro de Novo Banco | US01-BDD-01 (Positivo) |
| | | US01-BDD-02 (Negativo - Código duplicado) |
| | | US01-BDD-03 (Negativo - CNPJ inválido) |
| **US02** | Edição de Banco já Cadastrado | US02-BDD-01 (Positivo) |
| | | US02-BDD-02 (Negativo - Código bloqueado) |
| | | US02-BDD-03 (Negativo - CNPJ inválido) |
| **US03** | Validação de CNPJ | US03-BDD-01 (Positivo) |
| | | US03-BDD-02 (Negativo - Dígitos insuficientes) |
| | | US03-BDD-03 (Negativo - CNPJ inexistente) |

Essas histórias são independentes, testáveis e cobrem todas as regras de negócio especificadas nos critérios de aceite.