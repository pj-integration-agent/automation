**User Stories – Módulo de Bancos Nacionais**

| ID | Como | Quero | Para |
|----|------|-------|------|
| **US01** | usuário do sistema bancário | criar um novo registro de banco | registrar informações de forma única e válida, garantindo integridade dos dados |
| **US02** | usuário do sistema bancário | editar um registro de banco já existente (exceto o campo “Código”) | atualizar dados de bancos sem alterar a identidade principal e manter a consistência |
| **US03** | usuário do sistema bancário | visualizar a lista de bancos cadastrados | ter visibilidade rápida e localizar facilmente o banco que deseja abrir para edição |

> **Observação**:  
> - O “Código” deve ser **único** entre todos os bancos cadastrados.  
> - Os campos **Código, Descrição do Banco, Apelido, Número de inscrição no SBP, Banco Controlador e CNPJ** são obrigatórios.  
> - O campo **Banco Controlador** é uma lista (dropdown) com os bancos controladores já existentes.  
> - O **CNPJ** deve ser válido (formato e existência verificadas no sistema).  
> - Ao salvar, o sistema deve exibir confirmação de sucesso ou mensagem de erro apropriada.

---

## US01 – Criação de novo banco

**Descrição detalhada**  
Ao clicar na opção “Novo”, o usuário deve ser levado a uma tela de cadastro onde os campos obrigatórios precisam ser preenchidos. O sistema deve validar:

1. **Código** – único (não pode coincidir com outro já cadastrado).  
2. **Descrição do Banco, Apelido, Número de inscrição no SBP** – texto não vazio.  
3. **Banco Controlador** – escolha obrigatória na lista.  
4. **CNPJ** – formato válido e já existente no banco de dados.  

Após preencher os campos, o usuário clica em “Salvar” e o sistema grava o registro, exibindo mensagem de sucesso.

**Critérios de Aceite Objetivos**

| # | Critério |
|---|----------|
| 1 | A tela “Novo Banco” é exibida após o clique em “Novo”. |
| 2 | Todos os campos obrigatórios são visíveis e marcados com “*”. |
| 3 | O sistema bloqueia a entrada de um “Código” já existente, exibindo mensagem de erro “Código já cadastrado”. |
| 4 | O campo “CNPJ” aceita apenas números e verifica formato e existência; caso inválido exibe “CNPJ inválido ou inexistente”. |
| 5 | Ao clicar em “Salvar” com todos os campos válidos, o banco é registrado e a mensagem “Banco cadastrado com sucesso” é exibida. |
| 6 | Caso algum campo obrigatório esteja vazio, exibe mensagem “Campo <Nome> é obrigatório”. |
| 7 | O registro criado não pode ser modificado depois de salvo (exclui “Código”). |

---

## US02 – Edição de banco existente

**Descrição detalhada**  
O usuário deve conseguir abrir um registro de banco já cadastrado, editar todos os campos **exceto** o “Código”. O sistema deve manter as mesmas validações de criação (exclusividade de Código, obrigatoriedade, validade de CNPJ). Após clicar em “Salvar”, as alterações são persistidas e uma mensagem de sucesso é exibida.

**Critérios de Aceite Objetivos**

| # | Critério |
|---|----------|
| 1 | O usuário pode selecionar um banco da lista e abrir seu formulário de edição. |
| 2 | O campo “Código” é exibido em modo somente‑leitura (não editável). |
| 3 | Todos os demais campos mantêm validação de obrigatoriedade e formato. |
| 4 | Ao clicar em “Salvar” com dados válidos, o registro é atualizado e a mensagem “Banco atualizado com sucesso” aparece. |
| 5 | Se houver tentativa de alterar “Código”, o sistema ignora a mudança e mantém o original. |
| 6 | Mensagens de erro são exibidas para campos vazios ou CNPJ inválido. |

---

## US03 – Lista de bancos

**Descrição detalhada**  
O usuário deve ter acesso a uma visão tabular dos bancos cadastrados, com opção de abrir cada registro para edição. A lista facilita a localização e seleção de bancos existentes.

**Critérios de Aceite Objetivos**

| # | Critério |
|---|----------|
| 1 | A tela de listagem exibe colunas: Código, Descrição, Apelido, CNPJ. |
| 2 | Cada linha possui ação “Editar” que abre o formulário de edição do banco correspondente. |
| 3 | A lista pode ser filtrada por Código ou Descrição (opcional). |

---

# BDD – Cenários (imperativo, primeira pessoa)

> **Tag:** `@US01` – Criação de novo banco  
> **Tag:** `@US02` – Edição de banco existente  

## US01 – Cenários Positivos

```gherkin
@US01
CENÁRIO: Criar um novo banco com todos os campos válidos
  EU clico em "Novo"
  E preencho "Código" com "BN001"
  E preencho "Descrição do Banco" com "Banco Nacional XYZ"
  E preencho "Apelido" com "BNXZ"
  E preencho "Número de inscrição no SBP" com "123456"
  E escolho "Banco Controlador" com "Banco Central"
  E preencho "CNPJ" com "12.345.678/0001-90"
  E clico em "Salvar"
  ENTÃO devo ver a mensagem "Banco cadastrado com sucesso"
```

## US01 – Cenários Negativos

```gherkin
@US01
CENÁRIO: Não permitir duplicação de Código
  EU já tenho um banco com "Código" = "BN001"
  EU clico em "Novo"
  E preencho "Código" com "BN001"
  E preencho os demais campos corretamente
  E clico em "Salvar"
  ENTÃO devo ver a mensagem "Código já cadastrado"

@US01
CENÁRIO: Não permitir cadastro com campo obrigatório vazio
  EU clico em "Novo"
  E deixo "Descrição do Banco" em branco
  E preencho os demais campos corretamente
  E clico em "Salvar"
  ENTÃO devo ver a mensagem "Campo Descrição do Banco é obrigatório"

@US01
CENÁRIO: Não permitir cadastro com CNPJ inválido
  EU clico em "Novo"
  E preencho "CNPJ" com "123"
  E preencho os demais campos corretamente
  E clico em "Salvar"
  ENTÃO devo ver a mensagem "CNPJ inválido ou inexistente"
```

## US02 – Cenários Positivos

```gherkin
@US02
CENÁRIO: Editar dados de um banco já existente
  EU tenho um banco registrado com Código "BN001"
  EU clico em "Editar" ao lado do banco "BN001"
  E altero "Descrição do Banco" para "Banco Nacional ABC"
  E altero "Apelido" para "BNABC"
  E altero "Número de inscrição no SBP" para "987654"
  E altero "Banco Controlador" para "Banco Central"
  E altero "CNPJ" para "98.765.432/0001-12"
  E clico em "Salvar"
  ENTÃO devo ver a mensagem "Banco atualizado com sucesso"
```

## US02 – Cenários Negativos

```gherkin
@US02
CENÁRIO: Tentar alterar o Código durante a edição
  EU tenho um banco registrado com Código "BN001"
  EU clico em "Editar" ao lado do banco "BN001"
  E tento alterar "Código" para "BN999" (campo não editável)
  E clico em "Salvar"
  ENTÃO o "Código" permanece "BN001" e a mensagem "Banco atualizado com sucesso" aparece

@US02
CENÁRIO: Não permitir edição com campo obrigatório vazio
  EU tenho um banco registrado com Código "BN001"
  EU clico em "Editar" ao lado do banco "BN001"
  E deixo "Apelido" em branco
  E clico em "Salvar"
  ENTÃO devo ver a mensagem "Campo Apelido é obrigatório"

@US02
CENÁRIO: Não permitir edição com CNPJ inválido
  EU tenho um banco registrado com Código "BN001"
  EU clico em "Editar" ao lado do banco "BN001"
  E preencho "CNPJ" com "abc"
  E clico em "Salvar"
  ENTÃO devo ver a mensagem "CNPJ inválido ou inexistente"
```

---

### Observações de Implementação

1. **Validação de Código Único**  
   - A consulta de unicidade deve ocorrer no momento do clique em “Salvar”.  
   - Caso exista duplicata, impedir a gravação e exibir erro.

2. **Validação de CNPJ**  
   - Usar expressão regular para formato (`NN.NNN.NNN/NNNN-NN`).  
   - Validar existência via serviço de consulta cadastral (ou mock para testes).  

3. **UI**  
   - Campo “Código” em modo **read‑only** na tela de edição.  
   - Todos os campos obrigatórios marcados com “*”.  
   - Mensagens de erro exibidas de forma clara, abaixo do campo correspondente.

4. **Teste Automatizado**  
   - Para cada cenário acima, escrever testes de UI (Selenium/Playwright) ou testes de API (JUnit/Spring Test) conforme a arquitetura.  
   - As mensagens de sucesso/erro devem ser verificados no DOM.

5. **Rastreabilidade**  
   - Cada BDD scenario está explicitamente marcado com `@USxx` para facilitar a ligação entre requisitos e testes.  

Assim, as User Stories, critérios de aceite e cenários BDD garantem cobertura completa, clareza e testabilidade das funcionalidades de cadastro e edição de bancos no sistema.