name: Orquestrador CI/CD

on:
  workflow_dispatch:
    inputs:
      tipo-prompt:
        description: "Qual prompt deseja usar?"
        required: true
        type: choice
        options:
          - robot
          - playwright
        default: robot

      criacao-user-stories:
        description: "Criar user stories?"
        type: boolean
        required: true
        default: false

      criacao-bdd:
        description: "Criação dos BDDs?"
        type: boolean
        required: true
        default: false

      criacao-testes:
        description: "Criar testes?"
        type: boolean
        required: true
        default: false

      execucao-testes:
        description: "Executar testes?"
        type: boolean
        required: true
        default: false

      execucao-testes-de-carga:
        description: "Executar testes de carga?"
        type: boolean
        required: true
        default: false

permissions:
  contents: write
  pull-requests: write
  actions: write
  issues: write

jobs:
  user-stories:
    if: ${{ inputs.criacao-user-stories }}
    needs: test-api
    uses: pj-integration-agent/reusable-workflows/.github/workflows/criacao-user-stories.yaml@main
    secrets: inherit

  bdd:
    if: ${{ inputs.criacao-bdd }}
    needs: user-stories
    uses: pj-integration-agent/reusable-workflows/.github/workflows/criacao-bdd.yaml@main
    secrets: inherit

  testes:
    if: ${{ inputs.criacao-testes }}
    needs: bdd
    uses: pj-integration-agent/reusable-workflows/.github/workflows/criacao-testes.yaml@main
    secrets: inherit
    with:
      tipo-prompt: ${{ inputs.tipo-prompt }}

  executar-testes:
    if: ${{ inputs.execucao-testes }}
    uses: pj-integration-agent/reusable-workflows/.github/workflows/execucao-testes.yaml@main
    secrets: inherit

  execucao-testes-de-carga:
    if: ${{ inputs.execucao-testes-de-carga }}
    uses: pj-integration-agent/automation/.github/workflows/stress-test.yaml@main
    secrets: inherit
